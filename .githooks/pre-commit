#!/bin/bash

# å¤‰æ›´ã•ã‚ŒãŸSwiftãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—(1è¡Œã§ç©ºç™½åŒºåˆ‡ã‚Šï¼‰
changedPaths=$(git status -s . | awk '
    /^D/ {next} 
    !/\.swift$/ {next}
    /^R|^C/ {print $4; next}
    {print $2}
    ' | xargs -n1)

if xcrun --find swift-format >/dev/null && [ -n "$changedPaths" ]; then
  xcrun swift-format format --in-place $changedPaths
else
  echo "âš ï¸ swift-format ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚"
  exit 0
fi

if ! git diff --quiet -- '*.swift'; then
  echo ""
  echo "âœ¨ swift-format ã«ã‚ˆã‚Šãƒ•ã‚¡ã‚¤ãƒ«ãŒä¿®æ­£ã•ã‚Œã¾ã—ãŸã€‚"
  echo "å¤‰æ›´ã‚’ç¢ºèªã—ã€ã‚‚ã†ä¸€åº¦ã‚³ãƒŸãƒƒãƒˆã—ã¦ãã ã•ã„ã€‚"
  echo ""
  echo "ğŸ” ä¿®æ­£ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«:"
  git diff --stat
  exit 1
fi


